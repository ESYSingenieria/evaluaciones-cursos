<!-- dashboard-admin.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Panel de Administración</title>
  <link rel="stylesheet" href="styles.css" />

  <style>
    header { display:flex; justify-content:center; align-items:center; padding:10px 20px; background:#fff; }
    .logo { max-width:200px; height:auto; }

    .dashboard-container { width:100%; margin:0; padding:0 16px; box-sizing:border-box; }
    #usersList { width:100%; margin:0; padding:0; box-sizing:border-box; }

    #filtersBar{
      width:100%; background:#fff; border:1px solid #ddd; border-radius:6px; box-shadow:0 2px 4px rgba(0,0,0,.1);
      padding:16px; margin:16px 0; display:flex; flex-wrap:wrap; gap:12px; justify-content:flex-start; align-items:center;
    }
    #filtersBar input, #filtersBar select{
      padding:8px 12px; border:1px solid #ccc; border-radius:4px; background:#f9f9f9; font-size:14px;
    }
    #filtersBar input:focus, #filtersBar select:focus{
      outline:none; border-color:#007bff; box-shadow:0 0 0 2px rgba(0,123,255,.2);
    }

    .user-item {
      position: relative;
    }

    /* Caja de botones arriba a la derecha */
    .user-item .buttons {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    /* Estilos consistentes de los botones */
    .user-item .buttons button {
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    .user-item .buttons .delete-user-btn {
      background: #dc3545;
    }

    .user-item .buttons .logout-btn {
      background: #6c757d;
    }

    .evals-container{ display:flex; flex-direction:column; max-height:260px; overflow-y:auto; margin:12px 0; padding:4px; border:1px solid #ddd; border-radius:6px; }
    .eval-option{ display:flex; align-items:center; gap:8px; padding:6px 8px; margin:6px 0; border-radius:4px; }
    .eval-option input[type="checkbox"]{ margin:0 8px 0 0; }
    .eval-item{ background:#f9f9f9; border:1px solid #e0e0e0; border-radius:6px; padding:12px 16px; margin:12px 0; }
    .eval-grid{ display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:8px; }
    .eval-grid > div label{ font-size:12px; color:#444; display:block; margin-bottom:4px; }
    .muted{ color:#777; font-size:12px; }
    .hidden{ display:none !important; }

    #logoutContainer{ position:fixed; bottom:20px; right:20px; z-index:1000; }
    #logoutButton{ padding:10px 20px; background:#ff4d4d; color:#fff; border:none; border-radius:5px; cursor:pointer; }

    body.dark{ background:#121212; color:#eee; }
    body.dark .user-item{ background:#1e1e1e; box-shadow:0 2px 6px rgba(0,0,0,.5); }
    body.dark header{ background:#222; }

    @media (max-width:768px){
      header{ padding:8px 12px; }
      .dashboard-container{ width:100%; padding:0 10px; }
      #logoutContainer{ width:100%; }
    }

    .user-item .edit-user-btn,
    .user-item .save-user-btn,
    .user-item .cancel-user-btn{
      position: static !important; /* que se queden en el flujo, no arriba a la derecha */
    }

  </style>

  <!-- Firebase SDKs (v8 compat) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <!-- pdf-lib, fontkit, jsPDF -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/@pdf-lib/fontkit/dist/fontkit.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Lógica -->
  <script src="dashboard-admin.js" defer></script>
</head>
<body>
  <header>
    <a href="https://esys.cl/"><img src="logo.png" alt="Logo de la Empresa" class="logo" /></a>
  </header>

  <h1>Panel de Usuarios - Plataforma de Cursos</h1>

  <div class="dashboard-container">
    <!-- La barra de filtros se inyecta por JS aquí -->
    <div id="usersList">Cargando usuarios…</div>
  </div>

  <!-- Botón “+ Usuario” flotante -->
  <button id="createUserBtn"
          style="position:fixed; bottom:80px; right:20px; background:#28a745; color:#fff; border:none;
                 padding:12px 16px; border-radius:50%; font-size:20px; cursor:pointer; z-index:1000;">
    +
  </button>

  <!-- Formulario Crear Usuario -->
  <div id="createUserForm"
       style="display:none; position:fixed; top:10vh; left:50%; transform:translateX(-50%); background:#fff;
              padding:24px; border:1px solid #ccc; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.2); z-index:1001; width:360px;">
    <h3>Crear nuevo usuario</h3>
    <input id="newEmail"    type="email" placeholder="Email" style="width:100%;margin:8px 0;padding:8px;" />
    <input id="newPassword" type="text"   placeholder="Contraseña" value="123456" style="width:100%;margin:8px 0;padding:8px;" />
    <input id="newName"     type="text"   placeholder="Nombre"  style="width:100%;margin:8px 0;padding:8px;" />
    <input id="newRut"      type="text"   placeholder="RUT"     style="width:100%;margin:8px 0;padding:8px;" />
    <input id="newCustomId" type="text"   placeholder="CustomID" style="width:100%;margin:8px 0;padding:8px;" disabled />
    <input id="newCompany"  type="text"   placeholder="Empresa" style="width:100%;margin:8px 0;padding:8px;" />

    <label style="margin:8px 0 0; display:block;">Evaluaciones:</label>
    <div id="newEvalsContainer" class="evals-container"><!-- checkboxes + metas por evaluación --></div>

    <div style="text-align:right;margin-top:12px;">
      <button id="cancelCreateUser" style="margin-right:8px;">Cancelar</button>
      <button id="saveCreateUser"   style="background:#28a745;color:#fff;">Crear</button>
    </div>
  </div>

  <div id="logoutContainer"><button id="logoutButton">Cerrar Sesión</button></div>
</body>
</html>
