<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Panel de Cursos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="styles.css" />

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:#f3f4f6;color:#111;}
    header{display:flex;justify-content:center;align-items:center;padding:16px 0;background:#fff;border-bottom:1px solid #e5e7eb;}
    .logo{max-width:200px;height:auto;}
    .container{max-width:1180px;margin:24px auto;padding:0 16px;}
    h1{font-size:32px;font-weight:800;text-align:center;margin:10px 0 20px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
    .panel-card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.04);}
    .panel-card h2{margin:0 0 8px 0;font-size:22px}
    .btn{border:none;border-radius:8px;padding:8px 12px;font-weight:700;cursor:pointer}
    .btn-primary{background:#0d6efd;color:#fff}
    .btn-danger{background:#dc3545;color:#fff}
    .btn-neutral{background:#e9ecef;color:#111}
    .btn-sm{padding:6px 10px;font-size:13px}
    .course-card{position:relative;border:1px solid #e5e7eb;border-radius:12px;padding:14px 14px;margin:10px 0;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    .course-title{font-weight:800;font-size:18px;margin-bottom:6px}
    .meta{display:flex;gap:8px;flex-wrap:wrap;color:#555;font-size:13px}
    .tag{background:#f1f5f9;border:1px solid #e2e8f0;padding:2px 8px;border-radius:999px}
    .actions{position:absolute;top:10px;right:10px;display:flex;gap:6px}
    input[type="text"], input[type="date"], input[type="number"], select, textarea{
      border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;background:#f9fafb;outline:none;width:100%
    }
    textarea{min-height:80px}
    .row{display:flex;gap:10px;align-items:center}
    .row > *{flex:1}
    .list{max-height:65vh;overflow:auto}
    .help{color:#666;font-size:12px}

    /* Modales */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:flex-start;justify-content:center;z-index:50}
    .modal.open{display:flex}
    .modal-card{margin-top:6vh;background:#fff;border-radius:12px;border:1px solid #e5e7eb;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(920px,96vw);padding:16px}
    .modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .chip-row{display:flex;gap:8px;margin:6px 0}
    .small-btn{border:1px solid #e5e7eb;background:#f8fafc;border-radius:8px;padding:6px 8px;cursor:pointer}
    .q-card{border:1px dashed #e2e8f0;border-radius:10px;padding:12px;margin:10px 0}
    .q-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .q-row{display:flex;gap:8px;margin:6px 0;align-items:center}
    .q-sub{font-size:12px;color:#555;margin:6px 0}
  </style>

  <!-- Firebase SDK (compat v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script defer src="dashboard-admin_evals.js"></script>
</head>
<body>
  <header>
    <img src="logo.png" class="logo" alt="Logo ESYS">
  </header>

  <div class="container">
    <h1>Panel de Cursos</h1>

    <div class="grid">
      <!-- IZQUIERDA: Cursos Ofertados / Encuestas -->
      <section class="panel-card">
        <h2 id="createdTitle">Cursos Ofertados</h2>
        <div class="row" style="margin:8px 0 12px">
          <button id="btnNewCourse" class="btn btn-primary">Crear Nuevo Curso</button>
          <button id="btnNewSurvey" class="btn btn-primary" style="display:none">Crear Nueva Encuesta</button>
          <button id="btnToggleSurveys" class="btn btn-neutral">Encuestas de Satisfacción</button>
          <input id="searchCreated" type="text" placeholder="Buscar por nombre o ID..."/>
        </div>
        <div id="createdList" class="list"></div>
      </section>

      <!-- DERECHA: Historial -->
      <section class="panel-card">
        <h2>Historial de Cursos</h2>
        <div class="row" style="margin:8px 0 12px">
          <input id="searchDone" type="text" placeholder="Buscar por nombre, empresa o fecha..."/>
          <button id="btnNewHistory" class="btn btn-neutral">Agregar Curso</button>
        </div>
        <div id="doneList" class="list"></div>
      </section>
    </div>
  </div>

  <!-- Editor de CURSOS (existente) -->
  <div id="editor" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="editorTitle">Nuevo curso</h3>
        <div>
          <button id="btnSave" class="btn btn-primary btn-sm">Guardar</button>
          <button id="btnClose" class="btn btn-neutral btn-sm">Cerrar</button>
        </div>
      </div>

      <!-- Contenido del editor de cursos (igual que tenías) -->
      <div class="row">
        <div>
          <label>Identificador del Curso</label>
          <input id="docIdInput" type="text" placeholder="NFPA_70E.v3 (se autogenera si lo dejas vacío)"/>
        </div>
        <div>
          <label>Código (ID corto)</label>
          <input id="idInput" type="text" placeholder="03"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Nombre del Curso</label>
          <input id="nameInput" type="text" placeholder="Norma ... NFPA 70E 2024"/>
        </div>
        <div>
          <label>Puntaje de Aprobación</label>
          <input id="scoreInput" type="number" placeholder="92"/>
        </div>
      </div>

      <div>
        <label>Descripción</label>
        <textarea id="descInput" placeholder="Resumen del curso..."></textarea>
      </div>

      <div class="row">
        <div>
          <label>URL Manual (sin .pdf)</label>
          <input id="manualUrlInput" type="text" placeholder="carpeta/archivo"/>
        </div>
        <div>
          <label>Plantilla Certificado (sin .pdf)</label>
          <input id="certificateTmplInput" type="text" placeholder="plantillas/certificado_base"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Imagen portada (sin .jpg)</label>
          <input id="imageUrlInput" type="text" placeholder="portadas/img01"/>
        </div>
        <div>
          <label>Imagen insignia (sin .png)</label>
          <input id="imageBadgeInput" type="text" placeholder="badges/badge01"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Horas del curso</label>
          <input id="timeHoursInput" type="number" placeholder="16"/>
        </div>
      </div>

      <div>
        <label>Criterios</label>
        <div id="criteriaList"></div>
        <button id="btnAddCriterion" class="small-btn">+ Criterio</button>
      </div>

      <div>
        <label>Normas</label>
        <div id="standardsList"></div>
        <button id="btnAddStandard" class="small-btn">+ Norma</button>
      </div>

      <div>
        <label>Preguntas</label>
        <div id="questionsList"></div>
        <button id="btnAddQuestion" class="small-btn">+ Pregunta</button>
      </div>
    </div>
  </div>

  <!-- Editor de REALIZADOS -->
  <div id="historyEditor" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="historyTitle">Nuevo realizado</h3>
        <div>
          <button id="btnHistorySave" class="btn btn-primary btn-sm">Guardar</button>
          <button id="btnHistoryClose" class="btn btn-neutral btn-sm">Cerrar</button>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Curso base (documento)</label>
          <select id="historyCourseKey"></select>
          <div class="help">Selecciona el curso al que pertenece este realizado.</div>
        </div>
        <div>
          <label>Fecha de inicio</label>
          <input id="historyDate" type="date"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Forma</label>
          <select id="historyForma">
            <option value="abierto">abierto</option>
            <option value="cerrado">cerrado</option>
          </select>
        </div>
        <div>
          <label>Empresa (si es cerrado)</label>
          <input id="historyEmpresa" type="text" placeholder="Empresa"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Encuesta de satisfacción</label>
          <select id="historySurveySelect">
            <!-- se llena dinámicamente -->
          </select>
          <div class="help">Si no eliges, se usará la predeterminada.</div>
        </div>
      </div>

      <div id="historyParticipants" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- Editor de ENCUESTAS -->
  <div id="surveyEditor" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="surveyTitle">Nueva encuesta</h3>
        <div>
          <button id="btnSurveySave" class="btn btn-primary btn-sm">Guardar</button>
          <button id="btnSurveyClose" class="btn btn-neutral btn-sm">Cerrar</button>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Nombre de la encuesta</label>
          <input id="surveyNameInput" type="text" placeholder="Encuesta general de satisfacción"/>
          <div class="help">El identificador se generará desde este nombre.</div>
        </div>
        <div>
          <label>Asociación por defecto (opcional)</label>
          <select id="surveyEvalDefault"></select>
          <div class="help">Déjalo en “default” para usarla de forma general.</div>
        </div>
      </div>

      <div>
        <label>Preguntas</label>
        <div id="surveyQuestionsList"></div>
        <button id="btnSurveyAddQuestion" class="small-btn">+ Pregunta</button>
      </div>
    </div>
  </div>
</body>
</html>
